<?xml version="1.0" encoding="utf-8"?>
<addon addon_id="fs_save_custom_field" title="[FS] Address Custom Fields" version_string="1000010" version_id="1" url="" install_callback_class="FS_CustomFields_Installer" install_callback_method="install" uninstall_callback_class="FS_CustomFields_Installer" uninstall_callback_method="uninstall">
  <admin_navigation/>
  <admin_permissions/>
  <admin_style_properties/>
  <admin_templates/>
  <admin_template_modifications>
    <modification template="user_field_edit" modification_key="checkbox_address" description="address checkbox" execution_order="10" enabled="1" action="str_replace">
      <find><![CDATA[<xen:if is="!{$existingType}">]]></find>
      <replace><![CDATA[<xen:checkboxunit label="">
				<xen:option name="show_address" selected="{$field.show_address}">{xen:phrase show_during_address}</xen:option>
				
			</xen:checkboxunit>
$0]]></replace>
    </modification>
  </admin_template_modifications>
  <code_events/>
  <code_event_listeners>
    <listener event_id="controller_pre_dispatch" execute_order="10" callback_class="FS_CustomFields_Listener" callback_method="controllerPreDispatch" active="1" hint="" description="Forced user to save address fields...!"/>
    <listener event_id="load_class" execute_order="10" callback_class="FS_CustomFields_Listener" callback_method="loadClass" active="1" hint="" description=""/>
  </code_event_listeners>
  <cron/>
  <email_templates/>
  <email_template_modifications/>
  <optiongroups>
    <group group_id="fs_custom_address_fields" display_order="1" debug_only="0"/>
    <option option_id="fs_address_upgrade_ids" edit_format="textbox" data_type="string" can_backup="1">
      <default_value></default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="fs_custom_address_fields" display_order="1"/>
    </option>
    <option option_id="fs_save_address_fields" edit_format="textbox" data_type="string" can_backup="1">
      <default_value>receive_swag</default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="fs_custom_address_fields" display_order="2"/>
    </option>
  </optiongroups>
  <permissions>
    <permission_groups/>
    <permissions/>
    <interface_groups/>
  </permissions>
  <phrases>
    <phrase title="fs_address" version_id="1" version_string="1"><![CDATA[Address]]></phrase>
    <phrase title="fs_custom_address_fields" version_id="1" version_string="1"><![CDATA[Address]]></phrase>
    <phrase title="fs_enter_complete_all_fields" version_id="1" version_string="1000010"><![CDATA[Please enter a value for all fields.]]></phrase>
    <phrase title="fs_save_address_field" version_id="1" version_string="1"><![CDATA[Save this field]]></phrase>
    <phrase title="option_fs_address_upgrade_ids" version_id="1" version_string="1"><![CDATA[User Upgrades Ids]]></phrase>
    <phrase title="option_fs_address_upgrade_ids_explain" version_id="1" version_string="1"><![CDATA[Enter user upgrade ids here like 1,2,3,4,...]]></phrase>
    <phrase title="option_fs_save_address_fields" version_id="1" version_string="1"><![CDATA[Applicable Custom Field Id]]></phrase>
    <phrase title="option_fs_save_address_fields_explain" version_id="1" version_string="1"><![CDATA[Enter the custom field id here which you want to use for user to save address or ignore.]]></phrase>
    <phrase title="option_group_fs_custom_address_fields" version_id="1" version_string="1"><![CDATA[[FS] Address Custom Fields]]></phrase>
    <phrase title="option_group_fs_custom_address_fields_description" version_id="1" version_string="1"><![CDATA[]]></phrase>
    <phrase title="show_during_address" version_id="1" version_string="1"><![CDATA[Show on address page]]></phrase>
  </phrases>
  <route_prefixes>
    <route_type type="public">
      <prefix original_prefix="address" class="FS_CustomFields_Route_Prefix_Address" build_link="none"/>
    </route_type>
  </route_prefixes>
  <style_properties/>
  <templates>
    <template title="fs_address" version_id="1" version_string="1000010"><![CDATA[<xen:title>{xen:phrase fs_address}</xen:title>

<style>

.nextStep{
display: none;
}

</style>

<form method="post" class="xenForm AutoValidator"
	action="{xen:link 'address/save'}"
	data-fieldValidatorUrl="{xen:link register/validate-field}"
	data-redirect="true"
	>

    <xen:if is="!{$customFieldInputName}"><xen:set var="$customFieldInputName" value="custom_fields" /></xen:if>

	<dl class="ctrlUnit">
		<dt>
		<label for="ctrl_custom_field_receive_swag">{$customFields.receive_swag.title}:</label>
		<dfn>{xen:phrase required}</dfn>
		</dt>
		<dd>
			<ul class="checkboxColumns">
					<li><label><input type="radio" name="{$customFieldInputName}[receive_swag]" value="" {xen:checked 'strval({$customFields.receive_swag.field_value}) == ""'} /> <span class="muted">{xen:phrase no_selection}</span></label></li>
					<li><label><input type="radio" name="{$customFieldInputName}[receive_swag]" value="yes" {xen:checked 'strval({$customFields.receive_swag.field_value}) == strval("yes")'} /> Yes</label></li>
					<li><label><input type="radio" name="{$customFieldInputName}[receive_swag]" value="no" {xen:checked 'strval({$customFields.receive_swag.field_value}) == strval("no")'} /> No</label></li>

				</ul>
			
		</dd>
			
	</dl>
	
		<fieldset class="nextStep">
	
			<dl class="ctrlUnit">
				<dt>
				<label for="ctrl_custom_field_shipping_name">{$customFields.shipping_name.title}:</label>
				<xen:if is="{$customFields.shipping_name.required}"><dfn>{xen:phrase required}</dfn></xen:if>
				</dt>
				<dd>
                    <input type="text" name="{$customFieldInputName}[shipping_name]" value="{$customFields.shipping_name.field_value}" 
                            id="ctrl_custom_field_shipping_name"
                            data-validatorname="custom_field_shipping_name"
                            class="textCtrl" maxlength="{xen:if $customFields.shipping_name.max_length, $customFields.shipping_name.max_length}" 
                            />
				
				</dd>
			        
			</dl>
			
			<dl class="ctrlUnit">
				<dt>
				<label for="ctrl_custom_field_shipping_street_address">{$customFields.shipping_street_address.title}:</label>
				<xen:if is="{$customFields.shipping_street_address.required}"><dfn>{xen:phrase required}</dfn></xen:if>
				</dt>
				<dd>
                    <input type="text" name="{$customFieldInputName}[shipping_street_address]" value="{$customFields.shipping_street_address.field_value}" 
                            id="ctrl_custom_field_shipping_street_address"
                            data-validatorname="custom_field_shipping_street_address"
                            class="textCtrl" maxlength="{xen:if $customFields.shipping_street_address.max_length, $customFields.shipping_street_address.max_length}" 
                            />
				
				</dd>
			        
			</dl>
			
			<dl class="ctrlUnit">
				<dt>
				<label for="ctrl_custom_field_shipping_street_address_2">{$customFields.shipping_street_address_2.title}:</label>
				<xen:if is="{$customFields.shipping_street_address_2.required}"><dfn>{xen:phrase required}</dfn></xen:if>
				</dt>
				<dd>
                    <input type="text" name="{$customFieldInputName}[shipping_street_address_2]" value="{$customFields.shipping_street_address_2.field_value}" 
                            id="ctrl_custom_field_shipping_street_address_2"
                            data-validatorname="custom_field_shipping_street_address_2"
                            class="textCtrl" maxlength="{xen:if $customFields.shipping_street_address_2.max_length, $customFields.shipping_street_address_2.max_length}" 
                            />
				
				</dd>
			        
			</dl>
			
			<dl class="ctrlUnit">
				<dt>
				<label for="ctrl_custom_field_shipping_city">{$customFields.shipping_city.title}:</label>
				<xen:if is="{$customFields.shipping_city.required}"><dfn>{xen:phrase required}</dfn></xen:if>
				</dt>
				<dd>
                    <input type="text" name="{$customFieldInputName}[shipping_city]" value="{$customFields.shipping_city.field_value}" 
                            id="ctrl_custom_field_shipping_city"
                            data-validatorname="custom_field_shipping_city"
                            class="textCtrl" maxlength="{xen:if $customFields.shipping_city.max_length, $customFields.shipping_city.max_length}" 
                            />
				
				</dd>
			        
			</dl>

            <dl class="ctrlUnit">
				<dt>
				<label for="ctrl_custom_field_shipping_state">{$customFields.shipping_state.title}:</label>
				<xen:if is="{$customFields.shipping_state.required}"><dfn>{xen:phrase required}</dfn></xen:if>
				</dt>
				<dd>
                    <input type="text" name="{$customFieldInputName}[shipping_state]" value="{$customFields.shipping_state.field_value}" 
                            id="ctrl_custom_field_shipping_state"
                            data-validatorname="custom_field_shipping_state"
                            class="textCtrl" maxlength="{xen:if $customFields.shipping_state.max_length, $customFields.shipping_state.max_length}" 
                            />
				
				</dd>
			        
			</dl>

            <dl class="ctrlUnit">
				<dt>
				<label for="ctrl_custom_field_shipping_postal">{$customFields.shipping_postal.title}:</label>
				<xen:if is="{$customFields.shipping_postal.required}"><dfn>{xen:phrase required}</dfn></xen:if>
				</dt>
				<dd>
                    <input type="text" name="{$customFieldInputName}[shipping_postal]" value="{$customFields.shipping_postal.field_value}" 
                            id="ctrl_custom_field_shipping_postal"
                            data-validatorname="custom_field_shipping_postal"
                            class="textCtrl" maxlength="{xen:if $customFields.shipping_postal.max_length, $customFields.shipping_postal.max_length}" 
                            />
				
				</dd>
			        
			</dl>

            <dl class="ctrlUnit">
				<dt>
				<label for="ctrl_custom_field_shipping_country">{$customFields.shipping_country.title}:</label>
				<xen:if is="{$customFields.shipping_country.required}"><dfn>{xen:phrase required}</dfn></xen:if>
				</dt>
				<dd>
                    <input type="text" name="{$customFieldInputName}[shipping_country]" value="{$customFields.shipping_country.field_value}" 
                            id="ctrl_custom_field_shipping_country"
                            data-validatorname="custom_field_shipping_country"
                            class="textCtrl" maxlength="{xen:if $customFields.shipping_country.max_length, $customFields.shipping_country.max_length}" 
                            />
				
				</dd>
			        
			</dl>

            <dl class="ctrlUnit">
				<dt>
				<label for="ctrl_custom_field_t_shirt_size">{$customFields.t_shirt_size.title}:</label>
				<xen:if is="{$customFields.t_shirt_size.required}"><dfn>{xen:phrase required}</dfn></xen:if>
				</dt>
				<dd>
                     <select name="{$customFieldInputName}[t_shirt_size]" id="ctrl_custom_field_t_shirt_size" class="textCtrl">
                            <xen:if is="!{$customFields.t_shirt_size.required} OR !{$customFields.t_shirt_size.hasValue}">
                                <option value="" {xen:selected 'strval({$customFields.t_shirt_size.field_value}) == ""'}>&nbsp;</option>
                            </xen:if>
                            <xen:foreach loop="$customFields.t_shirt_size.fieldChoices" key="$choice" value="$text">
                                <option value="{$choice}" {xen:selected 'strval({$customFields.t_shirt_size.field_value}) == strval({$choice})'}>{xen:raw $text}</option>
                            </xen:foreach>
                            </select>
                   
				</dd>
			        
			</dl>

            <dl class="ctrlUnit">
				<dt>
				<label for="ctrl_custom_field_share_address">{$customFields.share_address.title}:</label>
				<xen:if is="{$customFields.share_address.required}"><dfn>{xen:phrase required}</dfn></xen:if>
				</dt>
				<dd>
                    <ul class="checkboxColumns">
                        <xen:if is="!{$customFields.share_address.required}">
                            <li><label><input type="radio" name="{$customFieldInputName}[share_address]" value="" {xen:checked 'strval({$customFields.share_address.field_value}) == ""'} /> <span class="muted">{xen:phrase no_selection}</span></label></li>
                        </xen:if>
                        <xen:foreach loop="$customFields.share_address.fieldChoices" key="$choice" value="$text">
                            <li><label><input type="radio" name="{$customFieldInputName}[share_address]" value="{$choice}" {xen:checked 'strval({$customFields.share_address.field_value}) == strval({$choice})'} /> {xen:raw $text}</label></li>
                        </xen:foreach>
                        </ul>
                    
				</dd>
			        
			</dl>
	
			
		</fieldset>
	
		<dl class="ctrlUnit submitUnit">
			<dt></dt>
			<dd><input type="submit" name="save" value="{xen:phrase save_changes}" accesskey="s" class="button primary" /></dd>
		</dl>
	

	<input type="hidden" name="_xfToken" value="{$visitor.csrf_token_page}" />
</form>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        function toggleNextStep() {
            var selectedValue = document.querySelector('input[name="{$customFieldInputName}[receive_swag]"]:checked');
            var nextStep = document.querySelector(".nextStep");

            if (selectedValue && selectedValue.value === "yes") {
                nextStep.style.display = "block"; 
            } else {
                nextStep.style.display = "none";
            }
        }

        toggleNextStep();

        document.querySelectorAll('input[name="{$customFieldInputName}[receive_swag]"]').forEach(function (radio) {
            radio.addEventListener("change", toggleNextStep);
        });
    });
</script>]]></template>
  </templates>
  <public_template_modifications/>
  <bb_code_media_sites/>
  <bb_codes/>
</addon>
